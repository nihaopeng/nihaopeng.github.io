# page attention

## problem

生成了预定token数的KV cache，但是实际使用时仅能使用一部分的缓存。就是每一次的文本生成都预分配了一定的内存，但是不一定所有的内存都被使用了。

显存的碎片不足以预分配给下一个文本的生成。

![alt text](image.png)

对于实际物理地址的索引是通过页表索引的，其主要作用是虚拟地址的分配是连续的，而物理地址可以是不连续的。当一个文本生成需要进行kv缓存时，向系统申请内存，系统会管理物理地址，拿到指定大小的内存，并构建映射。

以上操作的优势在于，物理地址的合并不影响虚拟地址的使用，以达到节省空间的功能。